<!DOCTYPE html>
<html>
  <head>
    <title>Forum</title>
  </head>
  <body>
    <style>
      body {
          font-family: "Comic Sans MS", cursive, sans-serif;
        background: linear-gradient(to bottom, #8B4513, #FFFF00);
      }
    </style>
    <marquee><h1>Welcome to the Forum!</h1></marquee>

    <h2>New Post</h2>
    <form id="new-post-form">
      <label for="post-title">Title:</label>
      <input type="text" id="post-title" name="post-title" required>

      <label for="post-content">Content:</label>
      <textarea id="post-content" name="post-content" required></textarea>

      <button type="submit">Submit</button>
    </form>

    <h2>Posts</h2>
    <ul id="post-list"></ul>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
      import { getFirestore, collection, orderBy, query, getDocs, addDoc } from 'https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore.js';
      // Initialize Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyAm9WUVUpsrVpdZTDi41FQLm6IluJDidqY",
        authDomain: "thevillage-5d1d4.firebaseapp.com",
        projectId: "thevillage-5d1d4",
        storageBucket: "thevillage-5d1d4.appspot.com",
        messagingSenderId: "105316126971",
        appId: "1:105316126971:web:6828d4cd6e07114656605e"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const postsRef = collection(db, 'posts');

      const postList = document.querySelector('#post-list');
      const newPostForm = document.querySelector('#new-post-form');

      // display all posts
      getDocs(query(postsRef, orderBy('date', 'desc'))).then(snapshot => {
        snapshot.forEach(doc => {
          const post = doc.data();
          const li = document.createElement('li');
          const date = post.date
              .toDate()
              .toLocaleDateString('en-us', { weekday:"long", year:"numeric", month:"short", day:"numeric", hour: "numeric", minute: "numeric"})
          li.textContent = `At ${date} - ${post.title}: ${post.content}`;
          postList.appendChild(li);
        });
      });

      // add new post
      newPostForm.addEventListener('submit', e => {
        e.preventDefault();

        const title = newPostForm['post-title'].value;
        const content = newPostForm['post-content'].value;

        addDoc(collection(db, 'posts'), {
          title,
          content,
          date: new Date()
        }).then(() => {
          newPostForm.reset();
          setTimeout(() => {
            window.location.reload();
          }, 1000);
        }).catch(error => {
          console.error('Error adding new post:', error);
        });
      });
    </script>
  </body>
</html>
